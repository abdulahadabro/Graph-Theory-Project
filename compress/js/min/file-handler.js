function openNewGraph(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){document.getElementById("files").addEventListener("change",handleFileSelect,!1);var e=document.getElementById("drop_zone");e.addEventListener("dragover",handleDragOver,!1),e.addEventListener("drop",handleFileDrageSelect,!1),$("#openFileContainer #files")[0].value="",$("#openFileContainer").addClass("show"),$("#openFileContainer").bind("click",function(e){e.target===e.currentTarget&&e.target===this&&$("#openFileContainer").removeClass("show"),e.stopPropagation()})}else alert("The File APIs are not fully supported in this browser.")}function handleFileSelect(e){readSelectedFile(e.target.files)}function handleFileDrageSelect(e){e.stopPropagation(),e.preventDefault(),readSelectedFile(e.dataTransfer.files)}function handleDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function readSelectedFile(e){for(var t,a=0;t=e[a];a++){var r=new FileReader;r.onerror=errorHandler,r.onabort=function(e){alert("File read cancelled")},r.onloadstart=function(e){$("#openFileDaialog .spinner").addClass("show")},r.onload=function(e){return function(t){var a=t.target.result,r=escape(e.name);$("#openFileDaialog .spinner").removeClass("show"),$("#openFileContainer").removeClass("show"),parseSelectedFile(a,r)}}(t),r.readAsText(t)}}function errorHandler(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:alert("File Not Found!");break;case e.target.error.NOT_READABLE_ERR:alert("File is not readable");break;case e.target.error.ABORT_ERR:break;default:alert("An error occurred reading this file.")}}function updateProgress(e){e.lengthComputable&&Math.round(e.loaded/e.total*100)<100&&$()}function parseSelectedFile(e,t){var a=$.parseXML(e),r=$(a),n=r.find("graph"),i=[];$(r.find("key")).each(function(){var e=this.id?this.id:null,t=$(this).attr("for")?$(this).attr("for"):null,a=$(this).attr("attr.name")?$(this).attr("attr.name"):null,r=$(this).attr("attr.type")?$(this).attr("attr.type"):null,n=null;if($(this).find("default")[0]){var l=$(this).find("default")[0].innerHTML;n=l||null}var d=$.extend(!0,{},KEY,{id:e,keyFor:t,keyName:a,keyType:r,keyDefault:n});i.push(d)});for(var l=0;l<n.length;l++){var d=$(n[l]),o={id:d.attr("id")?d.attr("id"):(new Date).getTime()+"",graphTitle:d.attr("id")?d.attr("id"):t,fileContent:e,edgedefault:d.attr("edgedefault")?d.attr("id"):"undirected",allNodes:[],allEdges:[]};i.length>0&&(o.keyList=i),$(d).find("node").each(function(){var e=this.id?this.id:(new Date).getTime()+"",t=this.name?this.name:this.id,a=null,r=$(this).find("data")[0];r&&(a={key:$(r).attr("key"),value:r.innerHTML?r.innerHTML:null});var n=$.extend(!0,{},NODE,{id:e,name:t,data:a});o.allNodes.push(n)}),$(d).find("edge").each(function(){var e=$(this).attr("id")?$(this).attr("id"):null,t=$(this).attr("source"),a=$(this).attr("target"),r=null,n=$(this).find("data")[0];n&&(r={key:$(n).attr("key"),value:n.innerHTML?n.innerHTML:null});var i=$.extend(!0,{},EDGE,{id:e,source:t,target:a,data:r});o.allEdges.push(i)}),handleNodeKeys(o),handleEdgeKeys(o),formGraphMatrix(o),createNewGraph(o)}}