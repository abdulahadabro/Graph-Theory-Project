function addNode(e,t){t||(t={id:(new Date).getTime()+"",name:"node",x:100,y:50});var i=MAIN_GRAPHS[e].radius,n=makeSVG("g",{class:"nodeGroup",nodeId:t.id}),r=t.color?t.color:DEFAULT_NODE_COLOR,l=makeSVG("circle",{cx:t.x,cy:t.y,r:i,stroke:"#262C37","stroke-width":3,fill:r,class:"node"});if(n.appendChild(l),t.name){var a=makeSVG("text",{x:t.x,y:t.y,"text-anchor":"middle",stroke:"black","stroke-width":0,fill:"#fff",class:"nodeName"},t.name);n.appendChild(a)}var s=makeSVG("ellipse",{cx:t.x-i,cy:t.y,rx:"5",ry:"5",style:"fill:black;stroke:black;stroke-width:1",onmouseover:"showNodeTooltip(evt,true);",onmousedown:"showNodeTooltip(evt);"});n.appendChild(s);var o=makeSVG("rect",{x:t.x+60,y:t.y,width:"51",height:"25",fill:"#63caba","text-anchor":"middle",class:"nodeTootltip",visibility:"hidden"});n.appendChild(o);var d=makeSVG("image",{x:t.x-i+2,y:t.y-i-4,height:"14px",width:"14px",class:"buttons connect",href:"img/connect-from.png",xlink:href="img/connect-from.png",visibility:"hidden"});n.appendChild(d);var g=makeSVG("image",{x:t.x-i+2+16,y:t.y-i-4,height:"14px",width:"14px",class:"buttons edit",href:"img/edit.png",xlink:href="img/edit.png",visibility:"hidden"});n.appendChild(g),$(g).bind("mousedown",function(t,i){var n=$(t.target).parent(),r=NODE_NAME;$($(n)[0]).find(".nodeName").text()!=r&&isNodeNameUsed(e,r)&&(r+=NODES_COUNTER++),$($(n)[0]).find(".nodeName").text(r);for(var l=$(n)[0].getAttribute("nodeId"),a=0;a<MAIN_GRAPHS[e].allSVGNodes.length;a++)if(MAIN_GRAPHS[e].allSVGNodes[a].nodeId==l){MAIN_GRAPHS[e].allSVGNodes[a].nodeText=r;break}array=MAIN_GRAPHS[e].allNodes;for(a=0;a<array.length;a++)if(array[a].id==l){array[a].name=r;break}initializeFromToNodesCombobox()});var u=makeSVG("image",{x:t.x-i+2+32,y:t.y-i-4,height:"14px",width:"14px",class:"buttons delete",href:"img/small_delete.png",xlink:href="img/small_delete.png",visibility:"hidden"});n.appendChild(u),$(u).bind("mousedown",function(t,i){var n=$(t.target).parent(),r=$(n)[0].getAttribute("nodeId");deleteAllConnectedEdges(e,r);for(l=0;l<MAIN_GRAPHS[e].allSVGNodes.length;l++)if(MAIN_GRAPHS[e].allSVGNodes[l].nodeId==r){MAIN_GRAPHS[e].allSVGNodes[l].nodeSvg.remove(),MAIN_GRAPHS[e].allSVGNodes.splice(l,1);break}for(var l=0;l<MAIN_GRAPHS[e].allNodes.length;l++)if(MAIN_GRAPHS[e].allNodes[l].id==r){MAIN_GRAPHS[e].allNodes.splice(l,1);break}formGraphMatrix(MAIN_GRAPHS[e]),initializeFromToNodesCombobox()}),$("#"+e+"Area .svgContainer").append(n),$(d).bind("mousedown",function(e,t){0==IS_CONNECT_EVENT?($(".graphArea.selected").addClass("connecting"),setConnectIcon(e,!0),NODE_1_TOCONNECT=$(e.target).parent().find("circle")[0],IS_CONNECT_EVENT=1):1==IS_CONNECT_EVENT&&(hideNodeTooltip(e),$(".graphArea.selected").removeClass("connecting"),setConnectIcon(e,!1),NODE_2_TOCONNECT=$(e.target).parent().find("circle")[0],connectTwoNodes(CUURENT_OPEN_GRAPH,NODE_1_TOCONNECT,NODE_2_TOCONNECT,void 0,!1),IS_CONNECT_EVENT=0,NODE_1_TOCONNECT=null,NODE_2_TOCONNECT=null)}),$(l).draggable().bind("mousedown",function(e,t){}).bind("drag",function(t,i){var n=i.position,r=$(this),l=r.prop("r").baseVal.value,a=n.left-parseInt(r.css("left")),s=n.top-parseInt(r.css("top")),o=r.prop("cx").baseVal.value+a,d=r.prop("cy").baseVal.value+s;updateNodePosition(e,r.parent(),o,d,l),updateLinesPositions()});var c={nodeId:t.id,nodeText:t.name,nodeSvg:n,radius:i};return MAIN_GRAPHS[e].allSVGNodes||(MAIN_GRAPHS[e].allSVGNodes=[]),MAIN_GRAPHS[e].allSVGNodes.push(c),c}function makeSVG(e,t,i){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)n.setAttribute(r,t[r]);return i&&(n.textContent=i),n}function connectTwoNodes(e,t,i,n,r){n||(n={weight:EDGE_WEIGHT});var l=t,a=i;void 0!==t.nodeSvg&&(l=t.nodeSvg.firstChild,a=i.nodeSvg.firstChild);var s=l==a;if(!r&&isEgdeExistBetweenTwoNodes(e,l,a))return!1;if(isEgdeAlreadyDrawn(e,l,a))return!1;var o,d=makeSVG("g",{class:"edgeGroup"}),g=parseFloat(l.getAttribute("cx")),u=parseFloat(l.getAttribute("cy")),c=parseFloat(a.getAttribute("cx")),A=parseFloat(a.getAttribute("cy")),p=(g+c)/2,v=(u+A)/2;if(s){var b=l.getAttribute("cx"),h=l.getAttribute("cy");o=makeSVG("path",{d:"M"+b+" "+h+" c 0 -140, -140 60, 0 0",stroke:"black","stroke-width":2,fill:"none",class:"nodesLine loop"}),p=b-52,v=h-30}else o=makeSVG("line",{x1:l.getAttribute("cx"),y1:l.getAttribute("cy"),x2:a.getAttribute("cx"),y2:a.getAttribute("cy"),stroke:"black","stroke-width":2,fill:"blue",class:"nodesLine"}),p=(g+c)/2,v=(u+A)/2;d.appendChild(o);var f=makeSVG("text",{x:p-10,y:v-5,"text-anchor":"middle","font-size":"13px",stroke:"black","stroke-width":1,class:"edgeWeight"},n.weight?n.weight:"");d.appendChild(f);var N=makeSVG("ellipse",{cx:p,cy:v,rx:"5",ry:"5",style:"fill:#FBA026;stroke:#F37934;stroke-width:2",onmouseover:"showEdgeTooltip(evt,true);",onmousedown:"showEdgeTooltip(evt);"});d.appendChild(N);var S=makeSVG("rect",{x:p+60,y:v,width:"37",height:"20",fill:"#63caba","text-anchor":"middle",class:"nodeTootltip",visibility:"hidden"});d.appendChild(S);var m=makeSVG("image",{x:p-2,y:v-27,height:"14px",width:"14px",class:"buttons edit",href:"img/edit.png",xlink:href="img/edit.png",visibility:"hidden"});d.appendChild(m),$(m).bind("mousedown",function(t,i){var n=$(t.target).parent(),r=$(n)[0].getAttribute("node1Id"),l=$(n)[0].getAttribute("node2Id");editEdgeWeight(e,r,l)});var G=makeSVG("image",{x:p+15,y:v-27,height:"14px",width:"14px",class:"buttons delete",href:"img/small_delete.png",xlink:href="img/small_delete.png",visibility:"hidden"});d.appendChild(G),$(G).bind("mousedown",function(t,i){var n=$(t.target).parent(),r=$(n)[0].getAttribute("node1Id"),l=$(n)[0].getAttribute("node2Id");deleteEdge(e,r,l),formGraphMatrix(MAIN_GRAPHS[e])});var x=$(l).parent()[0].getAttribute("nodeId"),E=$(a).parent()[0].getAttribute("nodeId");d.setAttribute("node1Id",x),d.setAttribute("node2Id",E);var y={node1:l,node2:a,lineSvg:d,weight:n.weight};y=$.extend(!0,{},y,n),MAIN_GRAPHS[e].allSVGEdges||(MAIN_GRAPHS[e].allSVGEdges=[]),MAIN_GRAPHS[e].allSVGEdges.push(y),1!=r&&(MAIN_GRAPHS[e].allEdges.push({source:x,target:E,weight:n.weight}),formGraphMatrix(MAIN_GRAPHS[e])),$("#"+e+"Area .svgContainer").append(d),bringNodesToFront(e)}function updateLinesPositions(e){e||(e=CUURENT_OPEN_GRAPH);for(var t=MAIN_GRAPHS[e].allSVGEdges,i=0;i<t.length;i++){var n=t[i].node1,r=t[i].node2,l=$(t[i].lineSvg).find(".nodesLine")[0],a=0,s=0;if(l.hasClass("loop")){var o=parseFloat(n.getAttribute("cx")),d=parseFloat(n.getAttribute("cy"));a=o-52,s=d-30;var g="M"+o+" "+d+" c 0 -140, -140 60, 0 0";l.setAttribute("d",g)}else{l.setAttribute("x1",n.getAttribute("cx")),l.setAttribute("y1",n.getAttribute("cy")),l.setAttribute("x2",r.getAttribute("cx")),l.setAttribute("y2",r.getAttribute("cy"));var u=parseFloat(n.getAttribute("cx")),c=parseFloat(n.getAttribute("cy"));a=(u+parseFloat(r.getAttribute("cx")))/2,s=(c+parseFloat(r.getAttribute("cy")))/2}var A=$(t[i].lineSvg).find(".edgeWeight")[0];A.setAttribute("x",a-10),A.setAttribute("y",s-5);var p=$(t[i].lineSvg).find("ellipse")[0];p.setAttribute("cx",a),p.setAttribute("cy",s);var v=p.getAttribute("rx"),b=$(t[i].lineSvg).find("rect")[0];b.setAttribute("x",a-v),b.setAttribute("y",s-v-25);var h=$(t[i].lineSvg).find(".buttons.edit")[0];h.setAttribute("x",a-2),h.setAttribute("y",s-27);var f=$(t[i].lineSvg).find(".buttons.delete")[0];f.setAttribute("x",a+15),f.setAttribute("y",s-27)}}function hackSVG(){SVGElement&&SVGElement.prototype&&(SVGElement.prototype.hasClass=function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(this.getAttribute("class"))},SVGElement.prototype.addClass=function(e){this.hasClass(e)||this.setAttribute("class",this.getAttribute("class")+" "+e)},SVGElement.prototype.removeClass=function(e){var t=this.getAttribute("class").replace(new RegExp("(\\s|^)"+e+"(\\s|$)","g"),"$2");this.hasClass(e)&&this.setAttribute("class",t)},SVGElement.prototype.toggleClass=function(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)})}function showNodeTooltip(e,t){var i=e.target,n=$(i).parent().find("circle")[0],r=$(n).parent().find("rect")[0];if("hidden"==r.getAttribute("visibility")){var l=n.getAttribute("r"),a=n.getAttribute("cx")-l,s=n.getAttribute("cy")-l-10;r.setAttributeNS(null,"x",a),r.setAttributeNS(null,"y",s),r.setAttributeNS(null,"visibility","visible");for(var o=$(n).parent().find(".buttons"),d=0;d<o.length;d++)o[d].setAttributeNS(null,"visibility","visible")}else if(1!=t){r.setAttributeNS(null,"visibility","hidden");for(var o=$(n).parent().find(".buttons"),d=0;d<o.length;d++)o[d].setAttributeNS(null,"visibility","hidden")}}function showEdgeTooltip(e,t){var i=e.target,n=$(i).parent().find("ellipse")[0],r=$(i).parent().find("rect")[0];if("hidden"==r.getAttribute("visibility")){var l=n.getAttribute("rx"),a=n.getAttribute("cx")-l,s=n.getAttribute("cy")-l-25;r.setAttributeNS(null,"x",a),r.setAttributeNS(null,"y",s),r.setAttributeNS(null,"visibility","visible");for(var o=$(n).parent().find(".buttons"),d=0;d<o.length;d++)o[d].setAttributeNS(null,"visibility","visible")}else if(1!=t){r.setAttributeNS(null,"visibility","hidden");for(var o=$(n).parent().find(".buttons"),d=0;d<o.length;d++)o[d].setAttributeNS(null,"visibility","hidden")}}function hideNodeTooltip(e){var t=e.target;$(t).parent().find("rect")[0].setAttributeNS(null,"visibility","hidden");for(var i=$(t).parent().find(".buttons"),n=0;n<i.length;n++)i[n].setAttributeNS(null,"visibility","hidden")}function hideAllNodeTooltip(e){for(var t=e.target,i=$(t).find("rect"),n=0;n<i.length;n++)i[n].setAttributeNS(null,"visibility","hidden");for(var r=$(t).find(".buttons"),n=0;n<r.length;n++)r[n].setAttributeNS(null,"visibility","hidden")}function setConnectIcon(e,t){for(var i=e.target,n=$(i).parent().parent().find(".buttons.connect"),r=0;r<n.length;r++)1==t?(n[r].setAttributeNS(null,"href","img/connect-to.png"),n[r].setAttributeNS(null,"xlink",'href = "img/connect-to.png"')):(n[r].setAttributeNS(null,"href","img/connect-from.png"),n[r].setAttributeNS(null,"xlink",'href = "img/connect-from.png"'))}function deleteEdge(e,t,i){for(var n=MAIN_GRAPHS[e].allSVGEdges,r=0;r<n.length;r++){var l=$(n[r].node1).parent()[0].getAttribute("nodeId"),a=$(n[r].node2).parent()[0].getAttribute("nodeId");(t==l&&i==a||t==a&&i==l)&&(n[r].lineSvg.remove(),n.splice(r,1))}n=MAIN_GRAPHS[e].allEdges;for(r=0;r<n.length;r++){var s=n[r].source,o=n[r].target;(t==s&&i==o||t==o&&i==s)&&n.splice(r,1)}}function deleteAllConnectedEdges(e,t){for(var i=MAIN_GRAPHS[e].allSVGEdges,n=0;n<i.length;n++){var r=$(i[n].node1).parent()[0].getAttribute("nodeId"),l=$(i[n].node2).parent()[0].getAttribute("nodeId");t!=r&&t!=l||(i[n].lineSvg.remove(),i.splice(n,1),n--)}i=MAIN_GRAPHS[e].allEdges;for(n=0;n<i.length;n++){var a=i[n].source,s=i[n].target;t!=a&&t!=s||(i.splice(n,1),n--)}}function editEdgeWeight(e,t,i){for(var n=MAIN_GRAPHS[e].allSVGEdges,r=0;r<n.length;r++){var l=$(n[r].node1).parent()[0].getAttribute("nodeId"),a=$(n[r].node2).parent()[0].getAttribute("nodeId");if(t==l&&i==a||t==a&&i==l){n[r].weight=EDGE_WEIGHT;var s=n[r].lineSvg;null==EDGE_WEIGHT?$($(s).find(".edgeWeight")[0]).text(""):$($(s).find(".edgeWeight")[0]).text(n[r].weight);break}}n=MAIN_GRAPHS[e].allEdges;for(r=0;r<n.length;r++){var o=n[r].source,d=n[r].target;if(t==o&&i==d||t==d&&i==o){n[r].weight=EDGE_WEIGHT;break}}}function setChartInfoSubPanel(e){var t='<div class="chartGeneralInfo subPanel" >';t+='<div class="subPanelTitle row">General Information</div><div class="row title">Graph Name: '+MAIN_GRAPHS[e].graphTitle+"</div>",t+='<div class="row "> <div class="cell"># of Nodes: '+MAIN_GRAPHS[e].getGraphSize()+'</div> <div class="cell"># of Edges: '+MAIN_GRAPHS[e].allEdges.length+"</div></div>",t+='</div><div class="left-panel-header">Result</div><div id="panel-result"></div>',$("#secondPageInfoPanel").append($(t))}function createSubInfoPanel(e,t){var i='<div class="subPanel" ><div class="controlButtons" ><div class="minBtn" onClick="minimizeSubPanel(this)"></div><div class="closeBtn" onClick="closeSubPanel(this)"></div></div>';i+='<div class="subPanelTitle row">'+t.title+"</div>";for(var n=0;n<t.rows.length;n++){var r=t.rows[n];i+='<div class="row"><div class="rowLable">'+r.label+' : </div><div class="rowValue">'+r.value+"</div></div>"}i+="</div>",$("#panel-result").append($(i))}function minimizeSubPanel(e){var t=$(e),i=t.parent().parent();t.hasClass("max")?(t.removeClass("max"),i.css("max-height","initial")):(t.addClass("max"),i.css("max-height","22px"))}function closeSubPanel(e){$(e).parent().parent().remove()}function reColorNodes(e,t){var i=MAIN_GRAPHS[e].allNodes,n=MAIN_GRAPHS[e].allSVGNodes;if(t)for(a=0;a<n.length;a++){var r=n[a],l=t[a]>=0?COLORS_LIST[t[a]]:"#fff";$($($(r.nodeSvg)[0]).find(".node")[0]).attr("fill",l)}else for(var a=0;a<n.length;a++){var r=n[a],l=null!=i[a].color?i[a].color:DEFAULT_NODE_COLOR;$($($(r.nodeSvg)[0]).find(".node")[0]).attr("fill",l)}}function isNodeNameUsed(e,t){for(var i=MAIN_GRAPHS[e].allNodes,n=0;n<i.length;n++)if(i[n].name==t)return!0;return!1}